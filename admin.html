<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DayZç¤¾åŒºæ¨¡ç»„å±•ç¤º - ç®¡ç†å‘˜é¢æ¿</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- å¯¼èˆªæ¡ -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h1>DayZç¤¾åŒºæ¨¡ç»„å±•ç¤º</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">é¦–é¡µ</a>
                </li>
                <li class="nav-item">
                    <a href="mods.html" class="nav-link">æ¨¡ç»„åˆ—è¡¨</a>
                </li>
                <li class="nav-item">
                    <a href="about.html" class="nav-link">å…³äºæˆ‘ä»¬</a>
                </li>
                <li class="nav-item">
                    <a href="legal.html" class="nav-link">æ³•å¾‹å£°æ˜</a>
                </li>
                <li class="nav-item" id="adminNavItem" style="display: none;">
                    <a href="admin.html" class="nav-link">ç®¡ç†å‘˜é¢æ¿</a>
                </li>
            </ul>
            <div class="user-auth" id="userAuthContainer">
                <!-- åŠ¨æ€å†…å®¹å°†ç”±JavaScriptå¡«å…… -->
            </div>
            <div class="nav-toggle">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <section class="page-content">
            <div class="container">
                
                <!-- ç®¡ç†å‘˜æƒé™æ£€æŸ¥ -->
                <div id="adminCheck" style="display: none;">
                    <div class="notification" style="background: #e53e3e; color: white; padding: 1rem; border-radius: 5px; text-align: center; margin: 2rem 0;">
                        <h3>æƒé™ä¸è¶³</h3>
                        <p>æ‚¨éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½è®¿é—®æ­¤é¡µé¢ã€‚</p>
                        <p>è¯·ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•æˆ–è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ã€‚</p>
                        <a href="index.html" class="btn btn-primary" style="margin-top: 1rem;">è¿”å›é¦–é¡µ</a>
                    </div>
                </div>

                <!-- ç®¡ç†å‘˜é¢æ¿å†…å®¹ -->
                <div id="adminPanel" style="display: none;">
                    <!-- ç³»ç»Ÿç»Ÿè®¡ -->
                    <div class="admin-panel">
                        <div class="admin-header">
                            <h3 class="admin-title">ç³»ç»Ÿç»Ÿè®¡</h3>
                            <div class="admin-actions">
                                <button class="admin-btn secondary" id="refreshStatsBtn">åˆ·æ–°ç»Ÿè®¡</button>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon">ğŸ“¦</div>
                                <h4 id="totalMods">0</h4>
                                <p>æ€»æ¨¡ç»„æ•°</p>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">ğŸ“‚</div>
                                <h4 id="totalCategories">0</h4>
                                <p>åˆ†ç±»æ•°é‡</p>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">ğŸ‘¥</div>
                                <h4 id="totalUsers">0</h4>
                                <p>æ³¨å†Œç”¨æˆ·</p>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">â­</div>
                                <h4 id="featuredMods">0</h4>
                                <p>é¦–é¡µæ¨è</p>
                            </div>
                        </div>
                        <div class="stats-details">
                            <div class="stats-section">
                                <h4>æ¨¡ç»„åˆ†ç±»åˆ†å¸ƒ</h4>
                                <div id="categoryChart" class="category-chart">
                                    <!-- åˆ†ç±»å›¾è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                            <div class="stats-section">
                                <div class="activity-header">
                                    <h4>æœ€è¿‘æ´»åŠ¨</h4>
                                    <select id="activityFilter" class="activity-filter">
                                        <option value="all">å…¨éƒ¨æ´»åŠ¨</option>
                                        <option value="today">ä»Šæ—¥æ´»åŠ¨</option>
                                        <option value="week">æœ¬å‘¨æ´»åŠ¨</option>
                                        <option value="month">æœ¬æœˆæ´»åŠ¨</option>
                                    </select>
                                </div>
                                <div id="recentActivity" class="activity-dropdown">
                                    <!-- æœ€è¿‘æ´»åŠ¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ¨¡ç»„ç®¡ç† -->
                    <div class="admin-panel">
                        <div class="admin-header">
                            <h3 class="admin-title">æ¨¡ç»„ç®¡ç†</h3>
                            <div class="admin-actions">
                                <button class="admin-btn" id="addModBtn">æ·»åŠ æ–°æ¨¡ç»„</button>
                                <button class="admin-btn secondary" id="refreshModsBtn">åˆ·æ–°åˆ—è¡¨</button>
                            </div>
                        </div>

                        <!-- æ·»åŠ æ¨¡ç»„è¡¨å• -->
                        <div class="mod-form" id="addModForm" style="display: none;">
                            <h4>æ·»åŠ æ–°æ¨¡ç»„</h4>
                            <form id="modForm">
                                <div class="mod-form-group">
                                    <label for="modName">æ¨¡ç»„åç§°</label>
                                    <input type="text" id="modName" placeholder="è¯·è¾“å…¥æ¨¡ç»„åç§°" required>
                                </div>
                                <div class="mod-form-group">
                                    <label for="modDescription">æ¨¡ç»„æè¿°</label>
                                    <textarea id="modDescription" placeholder="è¯·è¾“å…¥æ¨¡ç»„æè¿°" required></textarea>
                                </div>
                                <div class="mod-form-group">
                                    <label for="modCategory">å¤§ç±»</label>
                                    <select id="modCategory" required>
                                        <option value="">è¯·é€‰æ‹©å¤§ç±»</option>
                                        <option value="æ­¦å™¨">æ­¦å™¨</option>
                                        <option value="æœè£…">æœè£…</option>
                                        <option value="è½½å…·">è½½å…·</option>
                                        <option value="å»ºç­‘">å»ºç­‘</option>
                                        <option value="å·¥å…·">å·¥å…·</option>
                                        <option value="åŠŸèƒ½">åŠŸèƒ½</option>
                                    </select>
                                </div>
                                <div class="mod-form-group">
                                    <label for="modModule">æ¨¡å—</label>
                                    <select id="modModule" required>
                                        <option value="">è¯·å…ˆé€‰æ‹©å¤§ç±»</option>
                                    </select>
                                </div>
                                <div class="mod-form-group">
                                    <label for="modAuthor">ä½œè€…</label>
                                    <input type="text" id="modAuthor" placeholder="è¯·è¾“å…¥ä½œè€…åç§°" required value="SKY">
                                </div>
                                <div class="mod-form-group">
                                    <label for="modVersion">ç‰ˆæœ¬</label>
                                    <input type="text" id="modVersion" placeholder="ä¾‹å¦‚ï¼š1.0.0" required value="1.0.0">
                                </div>
                                <div class="mod-form-group">
                                    <label for="modSize">æ–‡ä»¶å¤§å°</label>
                                    <input type="text" id="modSize" placeholder="ä¾‹å¦‚ï¼š2.5MB" required>
                                </div>
                                <div class="mod-form-group">
                                    <label for="modImage">å›¾ç‰‡URL</label>
                                    <input type="text" id="modImage" placeholder="è¯·è¾“å…¥å›¾ç‰‡URL" required>
                                </div>
                                <div class="mod-form-group">
                                    <label for="modFeatures">åŠŸèƒ½ç‰¹æ€§ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                                    <textarea id="modFeatures" placeholder="è¯·è¾“å…¥æ¨¡ç»„çš„åŠŸèƒ½ç‰¹æ€§ï¼Œæ¯è¡Œä¸€ä¸ªç‰¹æ€§" rows="3"></textarea>
                                </div>
                                <div class="mod-form-group">
                                    <label for="modScreenshots">æˆªå›¾URLï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                                    <textarea id="modScreenshots" placeholder="è¯·è¾“å…¥æˆªå›¾URLï¼Œæ¯è¡Œä¸€ä¸ªURL" rows="3"></textarea>
                                </div>
                                <div class="mod-form-group">
                                    <label for="modDownloadUrl">ä¸‹è½½é“¾æ¥</label>
                                    <input type="text" id="modDownloadUrl" placeholder="è¯·è¾“å…¥æ¨¡ç»„ä¸‹è½½é“¾æ¥">
                                </div>
                                <div class="mod-form-group">
                                    <label for="modGameVersion">å…¼å®¹æ¸¸æˆç‰ˆæœ¬</label>
                                    <input type="text" id="modGameVersion" placeholder="ä¾‹å¦‚ï¼šDayZ 1.27+" value="DayZ 1.28">
                                </div>
                                <div class="mod-form-group">
                                    <label for="modRequiredMods">ä¾èµ–æ¨¡ç»„</label>
                                    <input type="text" id="modRequiredMods" placeholder="ä¾‹å¦‚ï¼šCF, Community Framework" value="æ— ">
                                </div>
                                <div class="mod-form-group">
                                    <label for="modServerSide">è¿è¡Œç¯å¢ƒ</label>
                                    <select id="modServerSide">
                                        <option value="å®¢æˆ·ç«¯/æœåŠ¡ç«¯">å®¢æˆ·ç«¯/æœåŠ¡ç«¯</option>
                                        <option value="ä»…å®¢æˆ·ç«¯">ä»…å®¢æˆ·ç«¯</option>
                                        <option value="ä»…æœåŠ¡ç«¯">ä»…æœåŠ¡ç«¯</option>
                                    </select>
                                </div>
                                <div class="mod-form-group">
                                    <label for="modFeatured">é¦–é¡µæ˜¾ç¤º</label>
                                    <select id="modFeatured">
                                        <option value="false">ä¸æ˜¾ç¤º</option>
                                        <option value="true">æ˜¾ç¤ºåœ¨é¦–é¡µ</option>
                                    </select>
                                    <small style="color: #a0aec0;">æœ€å¤šå¯è®¾ç½®3ä¸ªæ¨¡ç»„åœ¨é¦–é¡µæ˜¾ç¤º</small>
                                </div>
                                <div class="mod-form-actions">
                                    <button type="submit" class="admin-btn">ä¿å­˜æ¨¡ç»„</button>
                                    <button type="button" class="admin-btn secondary" id="cancelModBtn">å–æ¶ˆ</button>
                                </div>
                            </form>
                        </div>

                        <!-- æ¨¡ç»„åˆ—è¡¨ -->
                        <div class="mods-list" id="modsList">
                            <h4>ç°æœ‰æ¨¡ç»„</h4>
                            <div id="modsGrid" class="mods-grid">
                                <!-- æ¨¡ç»„å°†é€šè¿‡ JavaScript åŠ¨æ€åŠ è½½ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 DayZç¤¾åŒºæ¨¡ç»„å±•ç¤º. ä¿ç•™æ‰€æœ‰æƒåˆ©. <a href="legal.html">æ³•å¾‹å£°æ˜</a></p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // ç®¡ç†å‘˜é¢æ¿åŠŸèƒ½
        class AdminPanel {
            constructor() {
                this.init();
            }
            
            init() {
                // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
                this.checkAdminAccess();
                
                // ç»‘å®šäº‹ä»¶
                this.bindEvents();
                
                // åŠ è½½æ¨¡ç»„åˆ—è¡¨
                this.loadModsList();
                
                // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
                this.loadStats();
            }
            
            // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
            checkAdminAccess() {
                const userData = localStorage.getItem('dayz_user');
                if (userData) {
                    const user = JSON.parse(userData);
                    if (user.role === 'admin') {
                        document.getElementById('adminPanel').style.display = 'block';
                        document.getElementById('adminCheck').style.display = 'none';
                    } else {
                        document.getElementById('adminPanel').style.display = 'none';
                        document.getElementById('adminCheck').style.display = 'block';
                    }
                } else {
                    document.getElementById('adminPanel').style.display = 'none';
                    document.getElementById('adminCheck').style.display = 'block';
                }
            }
            
            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // æ·»åŠ æ¨¡ç»„æŒ‰é’®
                document.getElementById('addModBtn').addEventListener('click', () => {
                    this.toggleModForm();
                });
                
                // å–æ¶ˆæŒ‰é’®
                document.getElementById('cancelModBtn').addEventListener('click', () => {
                    this.toggleModForm(false);
                });
                
                // åˆ·æ–°æŒ‰é’®
                document.getElementById('refreshModsBtn').addEventListener('click', () => {
                    this.loadModsList();
                    this.loadStats();
                });
                
                // åˆ·æ–°ç»Ÿè®¡æŒ‰é’®
                document.getElementById('refreshStatsBtn').addEventListener('click', () => {
                    this.loadStats();
                    this.showNotification('ç»Ÿè®¡ä¿¡æ¯å·²åˆ·æ–°', 'success');
                });
                
                // åˆ·æ–°ç»Ÿè®¡æŒ‰é’®
                document.getElementById('refreshStatsBtn').addEventListener('click', () => {
                    this.loadStats();
                    this.showNotification('ç»Ÿè®¡ä¿¡æ¯å·²åˆ·æ–°', 'success');
                });
                
                // æ¨¡ç»„è¡¨å•æäº¤
                document.getElementById('modForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveMod();
                });
                
                // å¤§ç±»é€‰æ‹©å˜åŒ–
                document.getElementById('modCategory').addEventListener('change', (e) => {
                    this.updateModuleOptions(e.target.value);
                });
            }
            
            // åˆ‡æ¢æ¨¡ç»„è¡¨å•æ˜¾ç¤º
            toggleModForm(show = true) {
                const form = document.getElementById('addModForm');
                form.style.display = show ? 'block' : 'none';
            }
            
            // æ›´æ–°æ¨¡å—é€‰é¡¹
            updateModuleOptions(category) {
                const moduleSelect = document.getElementById('modModule');
                moduleSelect.innerHTML = '<option value="">è¯·é€‰æ‹©æ¨¡å—</option>';
                
                const modules = this.getModulesForCategory(category);
                modules.forEach(module => {
                    const option = document.createElement('option');
                    option.value = module;
                    option.textContent = module;
                    moduleSelect.appendChild(option);
                });
            }
            
            // è·å–åˆ†ç±»å¯¹åº”çš„æ¨¡å—åˆ—è¡¨
            getModulesForCategory(category) {
                const categoryModules = {
                    'æ­¦å™¨': ['æªæ¢°', 'é…ä»¶', 'è¿‘èº«æ­¦å™¨', 'æŠ•æ·æ­¦å™¨'],
                    'æœè£…': ['å¥—è£…', 'å¤´ç›”', 'çœ¼é•œ', 'é¢å…·', 'ä¸Šè¡£', 'é˜²å¼¹è¡£', 'æ‰‹å¥—', 'èƒŒåŒ…', 'è…°å¸¦', 'è£¤å­', 'é‹å­'],
                    'è½½å…·': ['æ±½è½¦', 'æ‘©æ‰˜è½¦', 'ç›´å‡æœº', 'èˆ¹åª'],
                    'å»ºç­‘': ['æˆ¿å±‹', 'å›´æ ', 'é—¨', 'æ¥¼æ¢¯', 'è£…é¥°'],
                    'å·¥å…·': ['ä¿®ç†å·¥å…·', 'åŒ»ç–—å·¥å…·', 'çƒ¹é¥ªå·¥å…·', 'é‡‡é›†å·¥å…·'],
                    'åŠŸèƒ½': ['å¤©æ°”ç³»ç»Ÿ', 'ä»»åŠ¡ç³»ç»Ÿ', 'ç»æµç³»ç»Ÿ', 'AIç³»ç»Ÿ', 'ç‰¹æ®ŠåŠŸèƒ½', 'äº¤äº’ç³»ç»Ÿ', 'å¨±ä¹ç»„ä»¶']
                };
                return categoryModules[category] || [];
            }
            
            // ä¿å­˜æ¨¡ç»„
            saveMod() {
                // å¤„ç†åŠŸèƒ½ç‰¹æ€§ï¼ˆå°†æ–‡æœ¬åŒºåŸŸå†…å®¹è½¬æ¢ä¸ºæ•°ç»„ï¼‰
                const featuresText = document.getElementById('modFeatures').value.trim();
                const features = featuresText ? featuresText.split('\n').filter(line => line.trim()) : [];
                
                // å¤„ç†æˆªå›¾URLï¼ˆå°†æ–‡æœ¬åŒºåŸŸå†…å®¹è½¬æ¢ä¸ºæ•°ç»„ï¼‰
                const screenshotsText = document.getElementById('modScreenshots').value.trim();
                const screenshots = screenshotsText ? screenshotsText.split('\n').filter(line => line.trim()) : [];
                
                const modData = {
                    id: Date.now().toString(),
                    name: document.getElementById('modName').value.trim(),
                    description: document.getElementById('modDescription').value.trim(),
                    category: document.getElementById('modCategory').value,
                    module: document.getElementById('modModule').value,
                    version: document.getElementById('modVersion').value.trim(),
                    size: document.getElementById('modSize').value.trim(),
                    image: document.getElementById('modImage').value.trim(),
                    downloadUrl: document.getElementById('modDownloadUrl').value.trim(),
                    features: features,
                    screenshots: screenshots,
                    compatibility: {
                        gameVersion: document.getElementById('modGameVersion').value.trim(),
                        requiredMods: document.getElementById('modRequiredMods').value.trim(),
                        serverSide: document.getElementById('modServerSide').value
                    },
                    featured: document.getElementById('modFeatured').value === 'true',
                    createdAt: new Date().toISOString()
                };
                
                // éªŒè¯æ•°æ®
                if (!this.validateModData(modData)) {
                    return;
                }
                
                // ä¿å­˜åˆ°localStorage
                const mods = JSON.parse(localStorage.getItem('dayz_mods_production') || '[]');
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºç¼–è¾‘æ¨¡å¼
                const editId = document.getElementById('modForm').dataset.editId;
                if (editId) {
                    // æ›´æ–°ç°æœ‰æ¨¡ç»„
                    const index = mods.findIndex(m => m.id === editId);
                    if (index !== -1) {
                        mods[index] = modData;
                    }
                    // æ¸…é™¤ç¼–è¾‘æ ‡è®°
                    delete document.getElementById('modForm').dataset.editId;
                } else {
                    // æ·»åŠ æ–°æ¨¡ç»„
                    mods.push(modData);
                }
                
                localStorage.setItem('dayz_mods_production', JSON.stringify(mods));
                
                // è§¦å‘æ›´æ–°äº‹ä»¶
                window.dispatchEvent(new CustomEvent('mods-updated'));
                
                // é‡ç½®è¡¨å•
                document.getElementById('modForm').reset();
                
                // éšè—è¡¨å•
                this.toggleModForm(false);
                
                // åˆ·æ–°åˆ—è¡¨
                this.loadModsList();
                this.loadStats();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                this.showNotification('æ¨¡ç»„æ·»åŠ æˆåŠŸï¼', 'success');
            }
            
            // éªŒè¯æ¨¡ç»„æ•°æ®
            validateModData(modData) {
                if (!modData.name) {
                    this.showNotification('è¯·è¾“å…¥æ¨¡ç»„åç§°', 'error');
                    return false;
                }
                
                if (!modData.description) {
                    this.showNotification('è¯·è¾“å…¥æ¨¡ç»„æè¿°', 'error');
                    return false;
                }
                
                if (!modData.category) {
                    this.showNotification('è¯·é€‰æ‹©å¤§ç±»', 'error');
                    return false;
                }
                
                if (!modData.module) {
                    this.showNotification('è¯·é€‰æ‹©æ¨¡å—', 'error');
                    return false;
                }
                
                return true;
            }
            
            // åŠ è½½æ¨¡ç»„åˆ—è¡¨
            loadModsList() {
                const mods = JSON.parse(localStorage.getItem('dayz_mods_production') || '[]');
                const modsGrid = document.getElementById('modsGrid');
                
                modsGrid.innerHTML = '';
                
                if (mods.length === 0) {
                    modsGrid.innerHTML = '<p style="text-align: center; color: #a0aec0;">æš‚æ— æ¨¡ç»„æ•°æ®</p>';
                    return;
                }
                
                mods.forEach(mod => {
                    const modElement = this.createModElement(mod);
                    modsGrid.appendChild(modElement);
                });
            }
            
            // åˆ›å»ºæ¨¡ç»„å…ƒç´ 
            createModElement(mod) {
                const div = document.createElement('div');
                div.className = 'mod-item';
                div.innerHTML = `
                    <div class="mod-image">
                        <img src="${mod.image}" alt="${mod.name}" class="zoomable-image">
                        <div class="mod-category">${mod.category}</div>
                    </div>
                    <div class="mod-info">
                        <h3>${mod.name}</h3>
                        <p class="mod-description">${mod.description}</p>
                        <div class="mod-stats">
                            <span class="mod-version">${mod.version}</span>
                            <span class="mod-size">${mod.size}</span>
                        </div>
                        <div class="mod-actions">
                            <button class="admin-btn secondary" onclick="adminPanel.editMod('${mod.id}')">ç¼–è¾‘</button>
                            <button class="admin-btn" onclick="adminPanel.deleteMod('${mod.id}')" style="background: #e53e3e;">åˆ é™¤</button>
                        </div>
                    </div>
                `;
                return div;
            }
            
            // ç¼–è¾‘æ¨¡ç»„
            editMod(modId) {
                const mods = JSON.parse(localStorage.getItem('dayz_mods_production') || '[]');
                const mod = mods.find(m => m.id === modId);
                
                if (mod) {
                    // å¡«å……è¡¨å•æ•°æ®
                    document.getElementById('modName').value = mod.name;
                    document.getElementById('modDescription').value = mod.description;
                    document.getElementById('modCategory').value = mod.category;
                    this.updateModuleOptions(mod.category);
                    setTimeout(() => {
                        document.getElementById('modModule').value = mod.module;
                    }, 100);
                    document.getElementById('modVersion').value = mod.version;
                    document.getElementById('modSize').value = mod.size;
                    document.getElementById('modImage').value = mod.image;
                    
                    // å¡«å……æ–°å¢å­—æ®µ
                    document.getElementById('modDownloadUrl').value = mod.downloadUrl || '';
                    document.getElementById('modFeatures').value = mod.features ? mod.features.join('\n') : '';
                    document.getElementById('modScreenshots').value = mod.screenshots ? mod.screenshots.join('\n') : '';
                    document.getElementById('modGameVersion').value = mod.compatibility?.gameVersion || 'DayZ 1.23+';
                    document.getElementById('modRequiredMods').value = mod.compatibility?.requiredMods || 'æ— ';
                    document.getElementById('modServerSide').value = mod.compatibility?.serverSide || 'å®¢æˆ·ç«¯/æœåŠ¡ç«¯';
                    document.getElementById('modFeatured').value = mod.featured || false;
                    
                    // æ˜¾ç¤ºè¡¨å•
                    this.toggleModForm(true);
                    
                    // æ ‡è®°ä¸ºç¼–è¾‘æ¨¡å¼
                    document.getElementById('modForm').dataset.editId = modId;
                }
            }
            
            // åˆ é™¤æ¨¡ç»„
            deleteMod(modId) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡ç»„å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    const mods = JSON.parse(localStorage.getItem('dayz_mods_production') || '[]');
                    const filteredMods = mods.filter(m => m.id !== modId);
                    localStorage.setItem('dayz_mods_production', JSON.stringify(filteredMods));
                    
                    // è§¦å‘æ›´æ–°äº‹ä»¶
                    window.dispatchEvent(new CustomEvent('mods-updated'));
                    
                    this.loadModsList();
                    this.loadStats();
                    this.showNotification('æ¨¡ç»„åˆ é™¤æˆåŠŸï¼', 'success');
                }
            }
            
            // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
            loadStats() {
                try {
                    console.log('å¼€å§‹åŠ è½½ç»Ÿè®¡ä¿¡æ¯...');
                    
                    // ç¡®ä¿æ•°æ®åˆå§‹åŒ–
                    if (typeof initPresetUsers === 'function') {
                        initPresetUsers();
                    }
                    
                    // è·å–æ¨¡ç»„æ•°æ®
                    const modsData = localStorage.getItem('dayz_mods_production');
                    console.log('æ¨¡ç»„æ•°æ®:', modsData);
                    const mods = modsData ? JSON.parse(modsData) : [];
                    
                    // è·å–ç”¨æˆ·æ•°æ®
                    const usersData = localStorage.getItem('dayz_users');
                    console.log('ç”¨æˆ·æ•°æ®:', usersData);
                    const allUsers = usersData ? JSON.parse(usersData) : [];
                    
                    // è®¡ç®—åˆ†ç±»æ•°é‡
                    const categories = new Set();
                    const featuredMods = mods.filter(mod => mod.featured === true);
                    
                    mods.forEach(mod => {
                        if (mod.category) {
                            categories.add(mod.category);
                        }
                    });
                    
                    // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º - ç¡®ä¿å…ƒç´ å­˜åœ¨
                    const totalModsEl = document.getElementById('totalMods');
                    const totalCategoriesEl = document.getElementById('totalCategories');
                    const totalUsersEl = document.getElementById('totalUsers');
                    const featuredModsEl = document.getElementById('featuredMods');
                    
                    console.log('æ‰¾åˆ°çš„å…ƒç´ :', {
                        totalModsEl: !!totalModsEl,
                        totalCategoriesEl: !!totalCategoriesEl,
                        totalUsersEl: !!totalUsersEl,
                        featuredModsEl: !!featuredModsEl
                    });
                    
                    if (totalModsEl) {
                        totalModsEl.textContent = mods.length;
                        console.log('è®¾ç½®æ€»æ¨¡ç»„æ•°:', mods.length);
                    }
                    if (totalCategoriesEl) {
                        totalCategoriesEl.textContent = categories.size;
                        console.log('è®¾ç½®åˆ†ç±»æ•°é‡:', categories.size);
                    }
                    if (totalUsersEl) {
                        totalUsersEl.textContent = allUsers.length;
                        console.log('è®¾ç½®ç”¨æˆ·æ•°é‡:', allUsers.length);
                    }
                    if (featuredModsEl) {
                        featuredModsEl.textContent = featuredMods.length;
                        console.log('è®¾ç½®æ¨èæ¨¡ç»„æ•°:', featuredMods.length);
                    }
                    
                    // ç”Ÿæˆåˆ†ç±»å›¾è¡¨
                    this.generateCategoryChart(mods);
                    
                    // ç”Ÿæˆæœ€è¿‘æ´»åŠ¨
                    this.generateRecentActivity(mods);
                    
                    console.log('ç»Ÿè®¡ä¿¡æ¯åŠ è½½æˆåŠŸ:', {
                        mods: mods.length,
                        categories: categories.size,
                        users: allUsers.length,
                        featured: featuredMods.length
                    });
                } catch (error) {
                    console.error('åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
                    // è®¾ç½®é»˜è®¤å€¼ - ç¡®ä¿å…ƒç´ å­˜åœ¨
                    const totalModsEl = document.getElementById('totalMods');
                    const totalCategoriesEl = document.getElementById('totalCategories');
                    const totalUsersEl = document.getElementById('totalUsers');
                    const featuredModsEl = document.getElementById('featuredMods');
                    
                    console.log('é”™è¯¯å¤„ç† - æ‰¾åˆ°çš„å…ƒç´ :', {
                        totalModsEl: !!totalModsEl,
                        totalCategoriesEl: !!totalCategoriesEl,
                        totalUsersEl: !!totalUsersEl,
                        featuredModsEl: !!featuredModsEl
                    });
                    
                    if (totalModsEl) totalModsEl.textContent = '0';
                    if (totalCategoriesEl) totalCategoriesEl.textContent = '0';
                    if (totalUsersEl) totalUsersEl.textContent = '0';
                    if (featuredModsEl) featuredModsEl.textContent = '0';
                    
                    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    const categoryChart = document.getElementById('categoryChart');
                    const recentActivity = document.getElementById('recentActivity');
                    
                    if (categoryChart) categoryChart.innerHTML = '<p style="color: #a0aec0; text-align: center;">æ•°æ®åŠ è½½å¤±è´¥</p>';
                    if (recentActivity) recentActivity.innerHTML = '<p style="color: #a0aec0; text-align: center;">æ•°æ®åŠ è½½å¤±è´¥</p>';
                }
            }
            
            // ç”Ÿæˆåˆ†ç±»å›¾è¡¨
            generateCategoryChart(mods) {
                const categoryChart = document.getElementById('categoryChart');
                
                // ç»Ÿè®¡æ¯ä¸ªåˆ†ç±»çš„æ¨¡ç»„æ•°é‡
                const categoryCounts = {};
                mods.forEach(mod => {
                    if (mod.category) {
                        categoryCounts[mod.category] = (categoryCounts[mod.category] || 0) + 1;
                    }
                });
                
                if (Object.keys(categoryCounts).length === 0) {
                    categoryChart.innerHTML = '<p style="color: #a0aec0; text-align: center;">æš‚æ— åˆ†ç±»æ•°æ®</p>';
                    return;
                }
                
                let chartHTML = '<div class="category-chart-container">';
                
                Object.entries(categoryCounts).forEach(([category, count]) => {
                    const percentage = (count / mods.length * 100).toFixed(1);
                    chartHTML += `
                        <div class="category-item">
                            <div class="category-label">${category}</div>
                            <div class="category-value">${count}</div>
                            <div class="category-percentage">${percentage}%</div>
                        </div>
                    `;
                });
                
                chartHTML += '</div>';
                categoryChart.innerHTML = chartHTML;
            }
            
            // ç”Ÿæˆæœ€è¿‘æ´»åŠ¨ - ä¸‹æ‹‰åˆ—è¡¨æ˜¾ç¤º
            generateRecentActivity(mods) {
                const recentActivity = document.getElementById('recentActivity');
                
                // æŒ‰åˆ›å»ºæ—¶é—´æ’åºï¼Œå–æœ€è¿‘10ä¸ª
                const recentMods = mods
                    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                    .slice(0, 10);
                
                if (recentMods.length === 0) {
                    recentActivity.innerHTML = '<p style="color: #a0aec0; text-align: center;">æš‚æ— æ´»åŠ¨è®°å½•</p>';
                    return;
                }
                
                let activityHTML = '<select class="activity-select" size="5">';
                
                recentMods.forEach(mod => {
                    const date = new Date(mod.createdAt).toLocaleDateString('zh-CN');
                    const time = new Date(mod.createdAt).toLocaleTimeString('zh-CN', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    activityHTML += `
                        <option value="${mod.id}" class="activity-option">
                            ğŸ“¦ ${mod.name} - ${mod.category} (${date} ${time})
                        </option>
                    `;
                });
                
                activityHTML += '</select>';
                recentActivity.innerHTML = activityHTML;
            }
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = message;
                
                const colors = {
                    success: '#48bb78',
                    error: '#e53e3e',
                    info: '#63b3ed'
                };
                
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${colors[type] || colors.info};
                    color: white;
                    padding: 1rem 2rem;
                    border-radius: 5px;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    animation: slideIn 0.3s ease;
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
        }
        
        // åˆå§‹åŒ–ç”¨æˆ·è®¤è¯ç®¡ç†å™¨
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–é¢„è®¾ç”¨æˆ·æ•°æ®
            if (typeof initPresetUsers === 'function') {
                initPresetUsers();
            }
            new UserAuthManager();
        });
        
        // åˆå§‹åŒ–ç®¡ç†å‘˜é¢æ¿
        const adminPanel = new AdminPanel();
    </script>
</body>
</html>