<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DayZ社区模组展示 - 主页</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 导航条 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h1>DayZ社区模组展示</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link active">首页</a>
                </li>
                <li class="nav-item">
                    <a href="mods.html" class="nav-link">模组列表</a>
                </li>
                <li class="nav-item">
                    <a href="about.html" class="nav-link">关于我们</a>
                </li>
                <li class="nav-item">
                    <a href="legal.html" class="nav-link">法律声明</a>
                </li>
                <li class="nav-item" id="adminNavItem" style="display: none;">
                    <a href="admin.html" class="nav-link">管理员面板</a>
                </li>
            </ul>
            <div class="user-auth" id="userAuthContainer">
                <!-- 动态内容将由JavaScript填充 -->
            </div>
            <div class="nav-toggle">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 英雄区域 - 紧凑设计，突出特色模组 -->
        <section class="hero">
            <div class="hero-background">
                <div class="hero-particles"></div>
            </div>
            <div class="hero-content">
                <div class="hero-badge">
                    <span>🔥 热门推荐</span>
                </div>
                <h1 class="hero-title">
                    <span class="gradient-text">DayZ社区模组</span>
                    <span class="hero-subtitle">探索无限可能</span>
                </h1>
                <p class="hero-description">汇聚最精彩的DayZ社区模组，为你的游戏体验注入全新活力</p>
                <div class="hero-buttons">
                    <a href="mods.html" class="btn btn-primary btn-large">
                        <span class="btn-icon">🎮</span>
                        浏览所有模组
                    </a>
                </div>
            </div>
        </section>

        <!-- 特色模组推荐区域 - 重点突出 -->
        <section class="featured-mods" id="featuredModsSection">
            <div class="container">
                
                <div class="featured-mods-container" id="featuredModsContainer">
                    <!-- 默认状态：无特色模组时的提示 -->
                    <div class="no-featured-mods" id="noFeaturedMods">
                        <div class="empty-state">
                            <div class="empty-icon">⭐</div>
                            <h3>暂无特色模组</h3>
                            <p>管理员尚未设置特色模组推荐</p>
                            <a href="admin.html" class="btn btn-primary">前往管理面板设置</a>
                        </div>
                    </div>
                    
                    <!-- 特色模组网格 -->
                    <div class="featured-mods-grid" id="featuredModsGrid" style="display: none;">
                        <!-- 模组将通过 JavaScript 动态加载 -->
                    </div>
                </div>
            </div>
        </section>

        <!-- 统计数据区域 - 视觉化展示 -->
        <section class="stats">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon">📦</div>
                        <div class="stat-content">
                            <h4 class="stat-number" data-count="50">0</h4>
                            <p class="stat-label">优质模组</p>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">⬇️</div>
                        <div class="stat-content">
                            <h4 class="stat-number" data-count="1000">0</h4>
                            <p class="stat-label">浏览次数</p>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">🛠️</div>
                        <div class="stat-content">
                            <h4 class="stat-number" data-count="24">0</h4>
                            <p class="stat-label">技术支持</p>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">👥</div>
                        <div class="stat-content">
                            <h4 class="stat-number" data-count="500">0</h4>
                            <p class="stat-label">活跃用户</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 快速导航区域 -->
        <section class="quick-nav">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">快速导航</h2>
                    <p class="section-description">快速访问网站主要功能</p>
                </div>
                <div class="nav-grid">
                    <a href="mods.html" class="nav-card">
                        <div class="nav-icon">📚</div>
                        <h3>模组列表</h3>
                        <p>浏览所有可用模组</p>
                        <div class="nav-arrow">→</div>
                    </a>
                    <a href="about.html" class="nav-card">
                        <div class="nav-icon">ℹ️</div>
                        <h3>关于我们</h3>
                        <p>了解开发团队</p>
                        <div class="nav-arrow">→</div>
                    </a>
                    <a href="legal.html" class="nav-card">
                        <div class="nav-icon">⚖️</div>
                        <h3>法律声明</h3>
                        <p>使用条款和隐私政策</p>
                        <div class="nav-arrow">→</div>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 DayZ社区模组展示. 保留所有权利. <a href="legal.html">法律声明</a></p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // 初始化用户认证管理器
        document.addEventListener('DOMContentLoaded', function() {
            new UserAuthManager();
            loadFeaturedMods();
            animateStats();
            initScrollAnimations();
        });
        
        // 加载模组数据（支持JSON文件和localStorage回退）
        function loadModsData() {
            return new Promise((resolve, reject) => {
                // 首先尝试从JSON文件加载
                fetch('data/mods.json')
                    .then(response => response.json())
                    .then(mods => {
                        // 同时更新localStorage作为备份
                        localStorage.setItem('dayz_mods_production', JSON.stringify(mods));
                        resolve(mods);
                    })
                    .catch(error => {
                        console.log('JSON文件加载失败，尝试从localStorage加载:', error);
                        // 从localStorage加载备份数据
                        const backupMods = localStorage.getItem('dayz_mods_production');
                        if (backupMods) {
                            resolve(JSON.parse(backupMods));
                        } else {
                            resolve([]); // 返回空数组而不是拒绝
                        }
                    });
            });
        }
        
        // 加载首页特色模组
        function loadFeaturedMods() {
            console.log('开始加载首页特色模组...');
            
            // 从JSON文件或localStorage加载模组数据 - 移除重复的catch块
            loadModsData()
                .then(mods => {
                    console.log('加载的模组数据:', mods);
                    
                    const featuredMods = mods.filter(mod => mod.featured).slice(0, 3); // 最多显示3个
                    console.log('筛选出的首页显示模组:', featuredMods);
                    
                    const noFeaturedMods = document.getElementById('noFeaturedMods');
                    const featuredModsGrid = document.getElementById('featuredModsGrid');
                    
                    console.log('找到的模组容器:', noFeaturedMods, featuredModsGrid);
                    
                    if (featuredMods.length > 0) {
                        // 先移除内联样式，使用CSS类控制显示
                        noFeaturedMods.style.display = 'none';
                        featuredModsGrid.style.display = 'grid';
                        
                        // 清空容器
                        featuredModsGrid.innerHTML = '';
                        
                        featuredMods.forEach(mod => {
                            const modCard = document.createElement('div');
                            modCard.className = 'featured-mod-card';
                            
                            // 修复图片路径，确保使用正斜杠
                            const imagePath = mod.image ? mod.image.replace(/\\/g, '/') : 'images/weapon-mod.png';
                            
                            modCard.innerHTML = `
                                <div class="featured-mod-badge">⭐ 推荐</div>
                                <div class="featured-mod-image">
                                    <img src="${imagePath}" alt="${mod.name}" class="zoomable-image" data-zoom-src="${imagePath}" onerror="this.src='images/weapon-mod.png'">
                                    <div class="featured-mod-overlay">
                                        <div class="featured-mod-actions">
                                            <a href="details.html?item=${mod.id}" class="btn btn-primary">查看详情</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="featured-mod-info">
                                    <h4 class="featured-mod-title">${mod.name}</h4>
                                    <p class="featured-mod-description">${mod.description}</p>
                                    <div class="featured-mod-tags">
                                        <span class="tag tag-category">${mod.category}</span>
                                        <span class="tag tag-module">${mod.module}</span>
                                    </div>
                                    <div class="featured-mod-footer">
                                        <span class="featured-mod-author">作者: ${mod.author || 'SKY'}</span>
                                        <span class="featured-mod-version">${mod.version ? mod.version.replace(/^v+/i, 'v') : 'v1.0'}</span>
                                    </div>
                                </div>
                            `;
                            featuredModsGrid.appendChild(modCard);
                        });
                        
                        console.log('特色模组卡片已添加到页面');
                        
                        // 强制重绘，解决CSS显示问题
                        setTimeout(() => {
                            featuredModsGrid.style.display = 'none';
                            featuredModsGrid.offsetHeight; // 触发重排
                            featuredModsGrid.style.display = 'grid';
                        }, 10);
                        
                        // 初始化图片放大功能
                        if (typeof initImageZoom === 'function') {
                            setTimeout(() => {
                                initImageZoom();
                                console.log('图片放大功能已初始化');
                            }, 100);
                        } else {
                            console.warn('initImageZoom函数未找到，跳过图片放大功能初始化');
                        }
                    } else {
                        noFeaturedMods.style.display = 'flex';
                        featuredModsGrid.style.display = 'none';
                        console.log('没有设置首页显示的模组，显示空状态');
                    }
                });
        }
        
        // 数字动画效果
        function animateStats() {
            const statNumbers = document.querySelectorAll('.stat-number');
            
            // 从JSON文件或localStorage获取模组总数
            loadModsData()
                .then(mods => {
                    const modCount = mods.length;
                    
                    statNumbers.forEach(stat => {
                        // 如果是优质模组统计项，直接显示模组总数
                        if (stat.parentElement.querySelector('.stat-label').textContent === '优质模组') {
                            stat.textContent = modCount;
                        } else {
                            const target = parseInt(stat.getAttribute('data-count'));
                            const duration = 2000; // 2秒
                            const step = target / (duration / 16); // 60fps
                            let current = 0;
                            
                            const timer = setInterval(() => {
                                current += step;
                                if (current >= target) {
                                    current = target;
                                    clearInterval(timer);
                                }
                                stat.textContent = Math.floor(current);
                            }, 16);
                        }
                    });
                });
        }
        
        // 滚动动画效果
        function initScrollAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                    }
                });
            }, observerOptions);
            
            // 观察需要动画的元素
            const animatedElements = document.querySelectorAll('.featured-mod-card, .stat-item, .nav-card');
            animatedElements.forEach(el => observer.observe(el));
        }
        
        // 监听模组更新事件
        window.addEventListener('mods-updated', function() {
            loadFeaturedMods();
        });
    </script>
</body>
</html>